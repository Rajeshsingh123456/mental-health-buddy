<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mental Health Buddy - Mood Tracker & AI Support</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333; 
      min-height: 100vh;
      transition: background 0.3s;
    }
    body.dark-mode { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: #f4f4f4; }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    header { 
      text-align: center; padding: 20px 0; color: white; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      position: relative;
    }
    body.dark-mode header { color: #f4f4f4; }
    .theme-toggle { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; padding: 10px; border-radius: 50%; cursor: pointer; }
    .section { background: rgba(255,255,255,0.95); margin: 20px 0; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
    body.dark-mode .section { background: rgba(52,73,94,0.95); }
    h2 { text-align: center; color: #667eea; margin-bottom: 15px; }
    body.dark-mode h2 { color: #a8e6cf; }
    .mood-emojis { display: flex; justify-content: space-around; margin: 10px 0; flex-wrap: wrap; }
    .emoji-btn { font-size: 2rem; background: none; border: none; cursor: pointer; padding: 10px; border-radius: 50%; transition: transform 0.3s; margin: 5px; }
    .emoji-btn:hover, .emoji-btn.selected { transform: scale(1.2); background: #667eea; color: white; }
    #notes { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical; min-height: 80px; }
    body.dark-mode #notes { background: #34495e; border-color: #555; color: #f4f4f4; }
    button { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; transition: background 0.3s; margin: 5px; }
    button:hover { background: #5a67d8; }
    .chat-container { height: 300px; border: 1px solid #ddd; border-radius: 10px; padding: 10px; overflow-y: auto; background: #f9f9f9; margin: 10px 0; }
    body.dark-mode .chat-container { background: #34495e; border-color: #555; }
    .chat-message { margin: 10px 0; padding: 10px; border-radius: 10px; }
    .user-msg { background: #667eea; color: white; text-align: right; }
    .bot-msg { background: #e2e8f0; color: #333; }
    body.dark-mode .bot-msg { background: #4a5568; color: #f4f4f4; }
    #chatInput { width: 70%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
    body.dark-mode #chatInput { background: #34495e; border-color: #555; color: #f4f4f4; }
    #chart-container { position: relative; height: 300px; margin: 20px 0; }
    .streak { text-align: center; font-size: 1.2rem; color: #4CAF50; margin-top: 10px; }
    .resources { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .resource-link { background: #4CAF50; color: white; padding: 10px; border-radius: 10px; text-decoration: none; }
    .resource-link:hover { background: #45a049; }
    #weatherInsight { text-align: center; font-style: italic; color: #666; margin: 10px 0; }
    body.dark-mode #weatherInsight { color: #ccc; }
    @media (max-width: 600px) { 
      .container { padding: 10px; } 
      .mood-emojis { justify-content: center; } 
      .emoji-btn { font-size: 1.5rem; }
      #chatInput { width: 60%; }
    }
  </style>
</head>
<body>
  <header>
    <h1>üß† Mental Health Buddy</h1>
    <p>Your AI companion for mood tracking and support</p>
    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
  </header>

  <div class="container">
    <!-- Mood Section -->
    <div class="section">
      <h2>Log Your Mood Today</h2>
      <div class="mood-emojis">
        <button class="emoji-btn" onclick="selectMood('üò¢', 1, this)">üò¢ Sad</button>
        <button class="emoji-btn" onclick="selectMood('üòü', 2, this)">üòü Anxious</button>
        <button class="emoji-btn" onclick="selectMood('üòê', 3, this)">üòê Neutral</button>
        <button class="emoji-btn" onclick="selectMood('üò†', 4, this)">üò† Angry</button>
        <button class="emoji-btn" onclick="selectMood('üòä', 5, this)">üòä Happy</button>
      </div>
      <textarea id="notes" placeholder="How are you feeling? Add notes..."></textarea>
      <button onclick="logMood()">Save Mood</button>
      <div class="streak">Current Streak: <span id="streak">0</span> days</div>
    </div>

    <!-- Chat Section -->
    <div class="section">
      <h2>AI Chat Support</h2>
      <div class="chat-container" id="chatContainer"></div>
      <div style="display: flex; gap: 10px;">
        <input type="text" id="chatInput" placeholder="Type your message..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <!-- Mood Insights Section -->
    <div class="section">
      <h2>Mood Insights</h2>
      <div id="chart-container">
        <canvas id="moodChart"></canvas>
      </div>
      <p id="weatherInsight"></p>
      <button onclick="exportJournal()">Export Journal (PDF)</button>
    </div>

    <!-- Resources Section -->
    <div class="section">
      <h2>Quick Resources (India)</h2>
      <div class="resources">
        <a href="https://www.vandrevalafoundation.com/" class="resource-link" target="_blank">Vandrevala Helpline (24/7)</a>
        <a href="https://www.aasra.info/" class="resource-link" target="_blank">AASRA Suicide Prevention</a>
        <a href="https://www.samaritans.org/" class="resource-link" target="_blank">International Samaritans</a>
        <a href="https://www.mpower.in/" class="resource-link" target="_blank">Mpower - Mental Health</a>
      </div>
      <div style="text-align: center; margin-top: 15px;">
        <p>Daily Quote: <span id="dailyQuote">"You are stronger than you think."</span></p>
        <button onclick="newQuote()">New Quote</button>
      </div>
    </div>
  </div>

  <script>
    let moods = JSON.parse(localStorage.getItem('moods')) || [];
    let currentMood = null;
    let currentStreak = parseInt(localStorage.getItem('streak')) || 0;
    let chart = null;
    const API_KEY = 'YOUR_OPENWEATHERMAP_API_KEY'; // Optional for weather insights

    const BOT_RESPONSES = {
      stressed: "Take deep breaths: Inhale 4s, hold 4s, exhale 4s. Try a 5-min walk! üå≥",
      anxious: "Ground yourself: Name 5 things you see, 4 you touch, 3 you hear. You're safe. üõ°Ô∏è",
      sad: "It's okay to feel this. Journal or call a friend. Remember, this will pass. ‚òÄÔ∏è",
      angry: "Count to 10. Punch a pillow or exercise to release energy. üí™",
      happy: "That's awesome! Keep doing what makes you smile. Share the joy! üòÑ",
      default: "I'm here for you. Share more about your feelings, or try logging your mood today."
    };

    const QUOTES = [
      "You are stronger than you think.",
      "One small positive thought can change your whole day.",
      "Breathe. Let go. Remind yourself this moment is all you know for sure.",
      "Mental health is a process. It's about how you drive, not where you're going.",
      "It's okay not to be okay. Take it one day at a time.",
      "You don't have to control your thoughts. Just stop letting them control you."
    ];

    // Theme Toggle
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      document.querySelector('.theme-toggle').textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
    }

    // Select Mood
    function selectMood(emoji, value, btn) {
      currentMood = { emoji, value, date: new Date().toLocaleDateString() };
      document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    }

    // Log Mood with AI Response
    function logMood() {
      if (!currentMood) { alert('Please select a mood first! üòä'); return; }

      const notes = document.getElementById('notes').value.trim();
      const moodEntry = { ...currentMood, notes, time: new Date().toLocaleTimeString() };
      moods.push(moodEntry);
      localStorage.setItem('moods', JSON.stringify(moods));

      // Update streak
      const today = new Date().toLocaleDateString();
      const lastMood = moods[moods.length - 2];
      if (!lastMood || lastMood.date !== today) { currentStreak++; localStorage.setItem('streak', currentStreak); }
      document.getElementById('streak').textContent = currentStreak;

      alert(`Mood logged successfully! Your streak is now ${currentStreak} days. üèÜ`);
      document.getElementById('notes').value = '';
      document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));

      renderChart();
      getWeatherInsight();
      triggerMoodAIResponse(currentMood.emoji);
      currentMood = null;
    }

    // Trigger AI Response based on Mood
    function triggerMoodAIResponse(emoji) {
      let response = BOT_RESPONSES.default;
      switch (emoji) {
        case 'üò¢': response = BOT_RESPONSES.sad; break;
        case 'üòü': response = BOT_RESPONSES.anxious; break;
        case 'üò†': response = BOT_RESPONSES.angry; break;
        case 'üòä': response = BOT_RESPONSES.happy; break;
        case 'üòê': response = "Feeling neutral is okay! Reflect on small wins today. üåø"; break;
      }
      setTimeout(() => addChatMessage('Buddy AI', response), 500);
    }

    // Chat Functionality
    function sendMessage() {
      const input = document.getElementById('chatInput');
      const msg = input.value.trim();
      if (!msg) return;

      addChatMessage('You', msg);
      input.value = '';

      // Basic AI response
      let response = BOT_RESPONSES.default;
      const lower = msg.toLowerCase();
      if (lower.includes('stress') || lower.includes('tired')) response = BOT_RESPONSES.stressed;
      else if (lower.includes('anxious') || lower.includes('worry')) response = BOT_RESPONSES.anxious;
      else if (lower.includes('sad') || lower.includes('down')) response = BOT_RESPONSES.sad;
      else if (lower.includes('angry') || lower.includes('mad')) response = BOT_RESPONSES.angry;
      else if (lower.includes('happy') || lower.includes('good')) response = BOT_RESPONSES.happy;

      setTimeout(() => addChatMessage('Buddy AI', response), 800);
    }

    function addChatMessage(sender, text) {
      const container = document.getElementById('chatContainer');
      const div = document.createElement('div');
      div.className = `chat-message ${sender === 'You' ? 'user-msg' : 'bot-msg'}`;
      div.innerHTML = `<strong>${sender}:</strong> ${text}`;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    // Render Mood Chart
    function renderChart() {
      const ctx = document.getElementById('moodChart').getContext('2d');
      if (chart) chart.destroy();
      if (moods.length === 0) {
        ctx.font = '16px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.fillText('Log some moods to see trends!', ctx.canvas.width / 2, ctx.canvas.height / 2);
        return;
      }
      const last7Days = moods.slice(-7).reverse();
      const labels = last7Days.map(m => m.date);
      const data = last7Days.map(m => m.value);
      chart = new Chart(ctx, {
        type: 'line',
        data: { labels, datasets: [{ label: 'Mood Level (1-5)', data, borderColor: '#667eea', backgroundColor: 'rgba(102,126,234,0.2)', tension: 0.4, fill: true }] },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 5 } }, plugins: { legend: { display: true } } }
      });
    }

    // Weather placeholder
    function getWeatherInsight() {
      const insightEl = document.getElementById('weatherInsight');
      insightEl.innerHTML = "üå§Ô∏è Add OpenWeatherMap API key for personalized weather-mood insights";
    }

    // Daily Quote
    function newQuote() {
      const quote = QUOTES[Math.floor(Math.random() * QUOTES.length)];
      document.getElementById('dailyQuote').textContent = quote;
    }

    // PDF Export
    async function exportJournal() {
      const container = document.querySelector('.container');
      const canvas = await html2canvas(container);
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
      const imgProps = pdf.getImageProperties(imgData);
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
      pdf.save('MentalHealthJournal.pdf');
    }

    // Initialize
    document.getElementById('streak').textContent = currentStreak;
    renderChart();
  </script>
</body>
</html>
